<div class="seatmap-wrap  position-relative">
  <div class=" py-1 w-100 " [ngStyle]="{
    'position':'fixed',
    'top':'0',
    'left':'0',
    'width':'100%',
    'background':'#fff',
    'z-index':'1050'
  }">
    <div class="d-flex align-items-center px-5 gap-3 " [ngStyle]="{'width':'100%'}">
      <i class="fa fa-chevron-left fa-lg on_hover" (click)="goBack()"></i>
      <div class="d-flex  align-items-center justify-content-between w-100">
        <div class="d-flex flex-column">
          <h4 class=" my-0">{{movieDetails?.name}} - ({{commonService.userLangFormat()?.lang}}
            -{{commonService.userLangFormat()?.format}})</h4>
          <span class="text-muted  fw-semibold">{{venueDetails?.venueName}} |
            {{commonService.userSelectedDate()?.today}} | {{commonService.userSelectedShow().time}}</span>
        </div>
        <button class="btn btn-outline-danger  h-25 " (click)="open(seatModal)">{{noOfSelectedSeats}} Tickets</button>
      </div>
      <div class="legend">
        <span class="key available"></span> Available
        <span class="key selected"></span> Selected
        <span class="key booked"></span> Sold
      </div>
    </div>
    <div class="header px-5 py-1">
      <div class="times">
        @for(show of screenShows;track $index){
        @for( t of show.shows;track $index){
        <button (click)="switchShow(t,show)"
          [class.active]="t?.time == activeShow?.time && t?.showIds[0] == activeShow?.showIds?.[0]" class="time 
   d-flex text-muted flex-column justify-content-start align-items-center"
          style="width:107px;height:40px; font-size: 12px;font-weight: 700;border: 1px solid #22c55e;border-left: 4px solid #22c55e;">
          {{t.time}}<br><small style="font-size: 9px;">4K DOLBY</small></button>
        }
        }
      </div>
      @if(selectedSeats.length){
      <div class="summary">
        <button class="confirm" [disabled]="!selectedSeats.length" (click)="confirmBookNow()">Book Now</button>
      </div>
      }
    </div>
  </div>
  <div class="canvas-shell  ">
    <canvas #seatCanvas (click)="onCanvasClick($event)">
    </canvas>
  </div>
</div>
<!-- Modal Content -->
<ng-template #seatModal let-modal>
  <div class="modal-header border-0 w-100">
    <h5 class="modal-title  text-center w-100">How many seats?</h5>
  </div>
  <div class="modal-body text-center">
    <i class="fa fa-ticket fa-5x my-3 ticket_icon" aria-hidden="true"></i>
    <!-- Seat Selection -->
    <div class="d-flex justify-content-center gap-2 mb-3">
      @for(seat of [1,2,3,4,5,6,7,8,9,10];track $index){
      <span [class.selected]="noOfSelectedSeats === seat" class="seat-number" (click)="setNoOfSelectedSeats(seat)">
        {{ seat }}
      </span>
      }
    </div>
    <!-- Seat Categories -->
    <div class="d-flex justify-content-around mt-3 text-center">
      @for(layout of layouts;track $index){
      <div>
        <div class=" text-muted">{{ layout.layoutName | uppercase}}</div>
        <div class="fw-semibold">â‚¹{{ layout.price }}</div>
      </div>
      }
    </div>
    <!-- Select Seats Button -->
    <button class="btn select_seat_btn w-100 mt-4" (click)="close()">Select Seats</button>
  </div>
</ng-template>

<!-- Confirm Modal Template -->
<ng-template #confirmModal let-modal>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 ">
      <div class="modal-header justify-content-center">
        <h4 class="modal-title" id="loginPopupLabel">Login Required</h4>
      </div>
      <div class="modal-body border-0 text-center">
        <p>Please log in to book this event.</p>
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="openLoginModal()">Log In</button>
      </div>
    </div>
  </div>
</ng-template>

<!-- Proceed to book seat -->
<ng-template #confirmSeatBookingModal let-modal>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 ">
      <div class="modal-header justify-content-center">
        <h4 class="modal-title text-success" id="loginPopupLabel">Confirm Your Booking</h4>
      </div>
      <div class="modal-body border-0 text-center">
        <p class="">You are about to book Seats <span class="text-danger fw-bold">{{selectedSeats}}</span></p>
        <p class="fw-semibold fs-5">Price {{totalPrice | currency:'INR'}}</p>
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <button type="button" class="btn btn-outline-danger" (click)="close()">Cancel</button>
        <button type="button" class="btn btn-outline-primary" (click)="handleBookNow()">Book Now</button>
      </div>
    </div>
  </div>
</ng-template>